

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Post-processing for Mass Conservation Approach &mdash; CRNT4SBML 0.0.6 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Generating Presentable C-graphs" href="generating_c_graphs.html" />
    <link rel="prev" title="Creating the Equilibrium Manifold" href="creating_eq_manifold.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CRNT4SBML
          

          
          </a>

          
            
            
              <div class="version">
                0.0.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">CRNT4SBML</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="detect_bistability.html">Steps for Detecting Bistability</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="physiological_bounds.html">Creating Physiological Bounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="celldesigner_walkthrough.html">CellDesigner Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_crnt.html">Low Deficiency Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="deficiency_walkthrough.html">Mass Conservation Approach Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="injectivity_walkthrough.html">Semi-diffusive Approach Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_opt.html">Numerical Optimization Routine</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_cont.html">Numerical Continuation Routine</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_eq_manifold.html">Creating the Equilibrium Manifold</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Post-processing for Mass Conservation Approach</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#storing-important-information">Storing Important Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importing-important-information">Importing Important Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constructing-necessary-variables-for-ode-simulation">Constructing necessary variables for ODE simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#assigning-the-values-for-ode-simulation">Assigning the values for ODE simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-subplots-to-represent-the-ode-simulation-graphically">Creating subplots to represent the ODE simulation graphically</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-the-format-of-the-subplots">Setting up the format of the subplots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-middle-subplot">Creating the middle subplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-rightmost-subplot">Creating the rightmost subplot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-the-leftmost-subplot">Creating the leftmost subplot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="generating_c_graphs.html">Generating Presentable C-graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">Further Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="zbibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CRNT4SBML</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Post-processing for Mass Conservation Approach</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/post_processing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="post-processing-for-mass-conservation-approach">
<span id="post-processing-label"></span><h1>Post-processing for Mass Conservation Approach<a class="headerlink" href="#post-processing-for-mass-conservation-approach" title="Permalink to this headline">¶</a></h1>
<p>In this section we describe the general process that should be followed if one would like to simulate the ODE system or
conduct stability analysis of those reaction networks that produce bistability as determined by the mass conservation approach.</p>
<div class="section" id="storing-important-information">
<h2>Storing Important Information<a class="headerlink" href="#storing-important-information" title="Permalink to this headline">¶</a></h2>
<p>Given the act of performing the numerical optimization and continuation routines can take a significant amount of time
for highly complex networks, we will describe how to store the necessary information needed to simulate the ODEs. To
complete this process one will need to install <a class="reference external" href="https://pypi.org/project/dill/">dill</a>, a Python library that extends
Python’s pickle module for serializing and de-serializing Python objects. A simple way to do this is by using pip:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> pip install dill
</pre></div>
</div>
<p>Using dill and Numpy, we can now save the parameter sets produced by optimization and the variables and values
constructed by continuation that will be necessary when simulating the ODE system of the network. This is done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">crnt4sbml</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">import</span> <span class="nn">dill</span>

<span class="n">network</span> <span class="o">=</span> <span class="n">crnt4sbml</span><span class="o">.</span><span class="n">CRNT</span><span class="p">(</span><span class="s2">&quot;sbml_files/Fig1Ci.xml&quot;</span><span class="p">)</span>

<span class="n">opt</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_mass_conservation_approach</span><span class="p">()</span>

<span class="n">bounds</span><span class="p">,</span> <span class="n">concentration_bounds</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">get_optimization_bounds</span><span class="p">()</span>

<span class="n">params_for_global_min</span><span class="p">,</span> <span class="n">obj_fun_val_for_params</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">run_optimization</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                                                     <span class="n">concentration_bounds</span><span class="o">=</span><span class="n">concentration_bounds</span><span class="p">)</span>

<span class="n">numpy</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;params.npy&#39;</span><span class="p">,</span> <span class="n">params_for_global_min</span><span class="p">)</span>

<span class="n">multistable_param_ind</span><span class="p">,</span> <span class="n">plot_specifications</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">run_greedy_continuity_analysis</span><span class="p">(</span><span class="n">species</span><span class="o">=</span><span class="s2">&quot;s15&quot;</span><span class="p">,</span>
                                                                                <span class="n">parameters</span><span class="o">=</span><span class="n">params_for_global_min</span><span class="p">,</span>
                                                                                <span class="n">auto_parameters</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PrincipalContinuationParameter&#39;</span><span class="p">:</span> <span class="s1">&#39;C3&#39;</span><span class="p">})</span>

<span class="n">odes</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_c_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_ode_system</span><span class="p">()</span>
<span class="n">sympy_reactions</span> <span class="o">=</span> <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">get_c_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_reactions</span><span class="p">()]</span>
<span class="n">sympy_species</span> <span class="o">=</span> <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">network</span><span class="o">.</span><span class="n">get_c_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_species</span><span class="p">()]</span>
<span class="n">concentration_funs</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">get_concentration_funs</span><span class="p">()</span>
<span class="n">BT_matrix</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_c_graph</span><span class="p">()</span><span class="o">.</span><span class="n">get_b</span><span class="p">()</span>

<span class="n">important_variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">odes</span><span class="p">,</span> <span class="n">sympy_reactions</span><span class="p">,</span> <span class="n">sympy_species</span><span class="p">,</span> <span class="n">concentration_funs</span><span class="p">,</span> <span class="n">BT_matrix</span><span class="p">,</span> <span class="n">multistable_param_ind</span><span class="p">,</span>
                       <span class="n">plot_specifications</span><span class="p">]</span>

<span class="n">dill</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;recurse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="c1"># allows us to pickle the lambdified functions</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;important_variables.dill&quot;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">important_variables</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
<p>Once this code is ran, one will obtain the files “params.npy” and “important_variables.dill”. Here, “params.npy” is a
special numpy file that holds the array of decision vectors produced by the optimization routine. The file
“important_variables.dill” is a dill file that contains the rest of the information necessary to simulate the ODE system.</p>
</div>
<div class="section" id="importing-important-information">
<h2>Importing Important Information<a class="headerlink" href="#importing-important-information" title="Permalink to this headline">¶</a></h2>
<p>Once the section above is completed, one can then import the information in the files params.npy and important_variables.dill
into a new Python session by creating the following script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dill</span>
<span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;important_variables.dill&quot;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">params_for_global_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;params.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the remaining subsections we will be using the files <a class="reference download internal" download="" href="_downloads/57bf5e4047fd30ca4bd772917f2b4238/params.npy"><code class="xref download docutils literal notranslate"><span class="pre">params.npy</span></code></a> and
<a class="reference download internal" download="" href="_downloads/5e2bd2c753684d721963ee5789cd7744/important_variables.dill"><code class="xref download docutils literal notranslate"><span class="pre">important_variables.dill</span></code></a> to demonstrate how one can create nice
looking plots that depict the simulation of the ODE system. For the full script of this section and the following sections
please review <a class="reference download internal" download="" href="_downloads/997e6e09ff40b965caf205fa572d9dc1/stability_analysis.py"><code class="xref download docutils literal notranslate"><span class="pre">stability_analysis.py</span></code></a>.</p>
</div>
<div class="section" id="constructing-necessary-variables-for-ode-simulation">
<h2>Constructing necessary variables for ODE simulation<a class="headerlink" href="#constructing-necessary-variables-for-ode-simulation" title="Permalink to this headline">¶</a></h2>
<p>Using the information obtained by the import of the files params.npy and important_variables.dill we will now
construct the function used by
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.odeint.html">scipy.integrate.odeint</a>
to compute the derivative of our species’ concentrations at a particular time t. This is done below by creating the
function “f”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># getting the ODE system</span>
<span class="n">odes</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># construct sympy form of reactions and species</span>
<span class="n">sympy_reactions</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sympy_species</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># creating the input for each ode lambda function</span>
<span class="n">lambda_inputs</span> <span class="o">=</span> <span class="n">sympy_reactions</span> <span class="o">+</span> <span class="n">sympy_species</span>

<span class="c1"># creating a lambda function for each ODE to make evaluating them simpler</span>
<span class="n">ode_lambda_functions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">odes</span><span class="p">)):</span>
    <span class="n">ode_lambda_functions</span> <span class="o">+=</span> <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">lambda_inputs</span><span class="p">,</span> <span class="n">odes</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>

<span class="c1"># first index of a species in input_vals</span>
<span class="n">start_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sympy_reactions</span><span class="p">)</span>


<span class="c1"># function to compute the derivative of y at t</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">ode_lambda_func</span><span class="p">,</span> <span class="n">start_ind</span><span class="p">):</span>

    <span class="c1"># setting species concentrations</span>
    <span class="n">inputs</span><span class="p">[</span><span class="n">start_ind</span><span class="p">:]</span> <span class="o">=</span> <span class="n">y</span>

    <span class="c1"># the model equations</span>
    <span class="n">ode_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ode_lambda_func</span><span class="p">:</span>
        <span class="n">ode_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">inputs</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">ode_vals</span>
</pre></div>
</div>
</div>
<div class="section" id="assigning-the-values-for-ode-simulation">
<h2>Assigning the values for ODE simulation<a class="headerlink" href="#assigning-the-values-for-ode-simulation" title="Permalink to this headline">¶</a></h2>
<p>In this section we now define particular values that we want to use to perform the ode simulation. In this instance
we use the decision vector values given by the third element of params_for_global_min.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># setting the decision vector values that define the ODE simulation</span>
<span class="n">decision_vector_values</span> <span class="o">=</span> <span class="n">params_for_global_min</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="c1"># choosing the plot specifications corresponding to the decision vector</span>
<span class="n">plot_specs</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># setting time grid for ODE simulation</span>
<span class="n">final_time</span> <span class="o">=</span> <span class="mi">150000</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">final_time</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="c1"># setting initial species concentration for upper branch creation</span>
<span class="n">s15_init</span> <span class="o">=</span> <span class="mf">2.0e5</span>

<span class="c1"># getting species&#39; concetrations for a specific parameter set</span>
<span class="n">species_concentrations</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
    <span class="n">species_concentrations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">decision_vector_values</span><span class="p">)))</span>

<span class="c1"># getting constant values corresponding to the conservation laws</span>
<span class="n">conservation_values</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">sympy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">species_concentrations</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="c1"># filling in the values for the reaction rates using optimization values</span>
<span class="n">input_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambda_inputs</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sympy_reactions</span><span class="p">)):</span>
    <span class="n">input_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">decision_vector_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-subplots-to-represent-the-ode-simulation-graphically">
<h2>Creating subplots to represent the ODE simulation graphically<a class="headerlink" href="#creating-subplots-to-represent-the-ode-simulation-graphically" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/bistability_of_ODEs.png"><img alt="_images/bistability_of_ODEs.png" class="align-center" src="_images/bistability_of_ODEs.png" style="width: 1000px; height: 220px;" /></a>
<p>Our goal in this section is to create the matplotlib subplot given above.</p>
<div class="section" id="setting-up-the-format-of-the-subplots">
<h3>Setting up the format of the subplots<a class="headerlink" href="#setting-up-the-format-of-the-subplots" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># C3 values to vary in ode solution</span>
<span class="n">C3_vec</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">plot_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">plot_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

<span class="n">C3_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">)</span>
<span class="n">C3_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">)</span>

<span class="n">C1</span> <span class="o">=</span> <span class="n">conservation_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">C2</span> <span class="o">=</span> <span class="n">conservation_values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># constructing format for plots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">})</span>
<span class="n">spec</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">width_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">],</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># setting up a colormap that&#39;s a simple transition</span>
<span class="n">mymap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s1">&#39;mycolors&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">])</span>

<span class="c1"># creating a colorbar that varies from C3_min to C3_max</span>
<span class="n">CS3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">mymap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">C3_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">C3_max</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-middle-subplot">
<h3>Creating the middle subplot<a class="headerlink" href="#creating-the-middle-subplot" title="Permalink to this headline">¶</a></h3>
<p>Here we construct the middle subplot which represents how the concentration of species s15 evolves over time for different
values of the conservation law constant C3. In this particular simulation we are starting with an initial species
concentration of 0pM for species s15. This will allow use to obtain the lower branch of the bistability plot.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">steady_state_vals1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">)):</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">C3_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">soln1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">odeint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">input_vals</span><span class="p">,</span> <span class="n">ode_lambda_functions</span><span class="p">,</span> <span class="n">start_index</span><span class="p">))</span>
    <span class="n">s15_sol</span> <span class="o">=</span> <span class="n">soln1</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">steady_state_vals1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">soln1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">C3_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">C3_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">C3_max</span> <span class="o">-</span> <span class="n">C3_min</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s15_sol</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">plot_specs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Initial [s15] = 0 pM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-rightmost-subplot">
<h3>Creating the rightmost subplot<a class="headerlink" href="#creating-the-rightmost-subplot" title="Permalink to this headline">¶</a></h3>
<p>In this section we are again simulating the ODE system and tracking the concentration of s15 over time for different
C3 values, however, we are now setting s15 = 2e5pM as the initial species concentration. This will allow the simulation
to obtain values on the upper branch of the bistability plot. Note here that we are letting the initial value of
species s1 = C3 - 2*s15_init. This value is chosen because it allows the conservation laws to be satisfied now that we
have set the intial s15 to a nonzero value. The specific equation of s1 can be found by consulting the third conservation law.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>

<span class="n">steady_state_vals2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">)):</span>
    <span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">C3_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">s15_init</span><span class="p">,</span> <span class="n">C2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">s15_init</span><span class="p">]</span>
    <span class="n">soln1</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">odeint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">input_vals</span><span class="p">,</span> <span class="n">ode_lambda_functions</span><span class="p">,</span> <span class="n">start_index</span><span class="p">))</span>
    <span class="n">s15_sol</span> <span class="o">=</span> <span class="n">soln1</span><span class="p">[:,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">steady_state_vals2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">soln1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">C3_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">C3_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">C3_max</span> <span class="o">-</span> <span class="n">C3_min</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">s15_sol</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;time (seconds)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">plot_specs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Initial [s15] = &quot;</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">format_float_scientific</span><span class="p">(</span><span class="n">s15_init</span><span class="p">,</span> <span class="n">exp_digits</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; pM&quot;</span><span class="p">)</span>

<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CS3</span><span class="p">)</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;C3&quot;</span><span class="p">)</span>
<span class="n">clb</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">set_powerlimits</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">clb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">clb</span><span class="o">.</span><span class="n">update_ticks</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-the-leftmost-subplot">
<h3>Creating the leftmost subplot<a class="headerlink" href="#creating-the-leftmost-subplot" title="Permalink to this headline">¶</a></h3>
<p>In the leftmost subplot we now plot the concentration values of s15 at the final time considered in the ODE simulations
above for the varying C3 values. This produces a bistability plot that nicely shows how different C3 values and initial
s15 concentration values will affect the stability of the ODE system. Note that this bistability plot produced mirrors
the bistability plot provided by the greedy_continuity_analysis and AUTO.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">,</span> <span class="n">steady_state_vals1</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">C3_vec</span><span class="p">,</span> <span class="n">steady_state_vals2</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;C3&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;[s15] pM&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">plot_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">plot_specs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;sci&#39;</span><span class="p">,</span> <span class="n">scilimits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;[s15] at &quot;</span> <span class="o">+</span> <span class="n">numpy</span><span class="o">.</span><span class="n">format_float_scientific</span><span class="p">(</span><span class="n">final_time</span><span class="p">,</span> <span class="n">exp_digits</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>One can then save and close the subplot created by adding the following to the script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;bistability_of_ODEs.png&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="generating_c_graphs.html" class="btn btn-neutral float-right" title="Generating Presentable C-graphs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="creating_eq_manifold.html" class="btn btn-neutral float-left" title="Creating the Equilibrium Manifold" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Brandon Reyes

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>