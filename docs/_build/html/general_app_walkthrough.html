

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>General Approach Walkthrough &mdash; CRNT4SBML 0.0.11 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/copybutton.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parallel CRNT4SBML" href="parallel_crnt4sbml.html" />
    <link rel="prev" title="Semi-diffusive Approach Walkthrough" href="injectivity_walkthrough.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CRNT4SBML
          

          
          </a>

          
            
            
              <div class="version">
                0.0.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">CRNT4SBML</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="detect_bistability.html">Steps for Detecting Bistability</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="physiological_bounds.html">Creating Physiological Bounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="celldesigner_walkthrough.html">CellDesigner Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_crnt.html">Low Deficiency Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="deficiency_walkthrough.html">Mass Conservation Approach Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="injectivity_walkthrough.html">Semi-diffusive Approach Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">General Approach Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel_crnt4sbml.html">Parallel CRNT4SBML</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_opt.html">Numerical Optimization Routine</a></li>
<li class="toctree-l1"><a class="reference internal" href="numerical_cont.html">Numerical Continuation Routine</a></li>
<li class="toctree-l1"><a class="reference internal" href="direct_simulation.html">Direct Simulation for the General Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="creating_eq_manifold.html">Creating the Equilibrium Manifold</a></li>
<li class="toctree-l1"><a class="reference internal" href="confidence_level.html">Confidence Level Routine</a></li>
<li class="toctree-l1"><a class="reference internal" href="generating_c_graphs.html">Generating Presentable C-graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">Further Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_use.html">An Example User Case Scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="zbibliography.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CRNT4SBML</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>General Approach Walkthrough</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/general_app_walkthrough.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="general-approach-walkthrough">
<span id="gen-app-label"></span><h1>General Approach Walkthrough<a class="headerlink" href="#general-approach-walkthrough" title="Permalink to this headline">Â¶</a></h1>
<p>Using the SBML file constructed as in <a class="reference internal" href="celldesigner_walkthrough.html#my-celldesigner-label"><span class="std std-ref">CellDesigner Walkthrough</span></a>, we will proceed by completing a more in-depth
explanation of running the general approach. Note that the general approach can
be ran on any network that has conservation laws, even if that network does have a sink/source. One can test whether or
not there are conservation laws by seeing if the output of <a class="reference internal" href="classes/crnt4sbml.Cgraph.html#crnt4sbml.Cgraph.get_dim_equilibrium_manifold" title="crnt4sbml.Cgraph.get_dim_equilibrium_manifold"><code class="xref py py-func docutils literal notranslate"><span class="pre">crnt4sbml.Cgraph.get_dim_equilibrium_manifold()</span></code></a> is
greater than zero. This tutorial will use <a class="reference download internal" download="" href="_downloads/687872c47e0571c451c754af1abd76b4/simple_biterminal.xml"><code class="xref download docutils literal notranslate"><span class="pre">simple_biterminal.xml</span></code></a>.
The following code will import crnt4sbml and the SBML file. For a little more detail on this process consider <a class="reference internal" href="basic_crnt.html#my-basic-label"><span class="std std-ref">Low Deficiency Approach</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">crnt4sbml</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">crnt4sbml</span><span class="o">.</span><span class="n">CRNT</span><span class="p">(</span><span class="s2">&quot;/path/to/simple_biterminal.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we then want to conduct the general approach, we must first initialize the general_approach, which is done as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GA</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">get_general_approach</span><span class="p">()</span>
</pre></div>
</div>
<p>Now that we have initialized the class, we have to tell the routine the values of the signal (or principal continuation parameter)
and response of the bifurcation diagram, as well as whether or not we would like to force a steady state. Just
as in <a class="reference internal" href="deficiency_walkthrough.html#my-deficiency-label"><span class="std std-ref">Mass Conservation Approach Walkthrough</span></a>, the signal or PCP is a conservation law. To select the PCP one needs to know which
conservation law to choose. The following command will provide the conservation laws derived by the initialization of the
general approach class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">opt</span><span class="o">.</span><span class="n">get_conservation_laws</span><span class="p">())</span>
</pre></div>
</div>
<p>This provides the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C1 = 1.0*s10 + 1.0*s11 + 1.0*s2s10 + 1.0*s2s9 + 1.0*s9
C2 = 1.0*s1 + 1.0*s2 + 1.0*s2s10 + 1.0*s2s9 + 2.0*s3 + 2.0*s6
</pre></div>
</div>
<p>The response of the bifurcation diagram can then be chosen as any species. For this particular example we will choose
the following signal and response:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">signal</span> <span class="o">=</span> <span class="s2">&quot;C2&quot;</span>
<span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;s11&quot;</span>
</pre></div>
</div>
<p>Now that we have the bifurcation parameters, we should consider whether or not we would like to force a steady state in the
ODE system formed by the network by fixing the reactions. Although forcing a steady state by fixing the reactions can provide
faster results for some networks when running optimization, it does restrict the solutions found to a particular
solution, rather than looking for a general solution. For this particular example, fixing the reactions leads to poor
results. Thus, we will choose to not fix the reactions, this is done by setting the fix_reaction variable to False
in <a class="reference internal" href="classes/crnt4sbml.GeneralApproach.html#crnt4sbml.GeneralApproach.initialize_general_approach" title="crnt4sbml.GeneralApproach.initialize_general_approach"><code class="xref py py-func docutils literal notranslate"><span class="pre">crnt4sbml.GeneralApproach.initialize_general_approach()</span></code></a>. Now we can initialize the rest of the general approach
as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GA</span><span class="o">.</span><span class="n">initialize_general_approach</span><span class="p">(</span><span class="n">signal</span><span class="o">=</span><span class="n">signal</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">fix_reactions</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>Now that the approach has been constructed, we can begin to define the specific information needed for the optimization
routine for the general approach. One very important value that must be provided to the optimization problem are the
bounds for the species and reactions. For this reason, it is useful to see the variables and the order in which they appear.
To do this one can add the following command to the script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="k">print</span><span class="p">(</span><span class="n">GA</span><span class="o">.</span><span class="n">get_input_vector</span><span class="p">()))</span>
</pre></div>
</div>
<p>This provides the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[re1, re1r, re2, re2r, re3, re4, re5f, re5d, re5c, re6, re7f, re7d, re7c, re8, s1, s2, s3, s6, s9, s10, s2s9, s11, s2s10]
</pre></div>
</div>
<p>Using the input vector provided, one can then construct the bounds which are necessary for the optimization problem
by creating a list of tuples where the first element corresponds to the lower bound value of the parameter and the second
element is the upper bound value of the parameter.</p>
<p>As creating these bounds is not initially apparent to novice users or may become cumbersome, we have created a function
call that will automatically generate physiological bounds based on the C-graph. To use this functionality one can
add the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bnds</span> <span class="o">=</span> <span class="n">GA</span><span class="o">.</span><span class="n">get_optimization_bounds</span><span class="p">()</span>
</pre></div>
</div>
<p>This provides the following values:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bnds = [(10000.0, 100000000.0), (1e-05, 0.001), (10000.0, 100000000.0), (1e-05, 0.001), (0.001, 1.0), (0.001, 1.0),
        (10000.0, 100000000.0), (1e-05, 0.001), (0.001, 1.0), (0.001, 1.0), (10000.0, 100000000.0), (1e-05, 0.001),
        (0.001, 1.0), (0.001, 1.0), (5e-13, 5e-07), (5e-13, 5e-07), (5e-13, 5e-07), (5e-13, 5e-07), (5e-13, 5e-07),
        (5e-13, 5e-07), (5e-13, 5e-07), (5e-13, 5e-07), (5e-13, 5e-07)]
</pre></div>
</div>
<p>For more information and the correctness on these bounds please refer to <a class="reference internal" href="physiological_bounds.html#physio-bnds-label"><span class="std std-ref">Creating Physiological Bounds</span></a>.</p>
<p>Although these bounds can be used for this example, they are not ideal. For this reason, we have chosen a particular set
of ranges for the species and reactions based on the input vector, which is given as follows (for reference, below we
have set the range for re1 to be between 2.4 and 2.42, and set the range for s2 to be between 18.0 and 18.5):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bnds = [(2.4, 2.42), (27.5, 28.1), (2.0, 2.15), (48.25, 48.4), (0.5, 1.1), (1.8, 2.1), (17.0, 17.5), (92.4, 92.6),
        (0.01, 0.025), (0.2, 0.25), (0.78, 0.79), (3.6, 3.7), (0.15, 0.25), (0.06, 0.065)] + [(0.0, 100.0),
        (18.0, 18.5), (0.0, 100.0), (0.0, 100.0), (27.0, 27.1), (8.2, 8.3), (90.0, 90.1), (97.5, 97.9), (30.0, 30.1)]
</pre></div>
</div>
<p>The next most important parameter for optimization is the number of initial points for the multi-start optimization. It
is usually good practice to run the optimization with 100 initial points and observe the minimum objective function
value achieved. If an objective function value smaller than machine epsilon is not achieved, it is best to rerun the
optimization with more initial points. If 10000 or more points are used and an objective function value smaller than
machine epsilon is not achieved, then it is possible that the network does not produce bistability (although this test
does not exclude the possibility for bistability to exist, as stated in the theory). One can even use the built-in
confidence level option as described in <a class="reference internal" href="confidence_level.html#confidence-level-label"><span class="std std-ref">Confidence Level Routine</span></a> to make an informed decision on whether or not to
continue performing more iterations. We state the number of initial points below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iters</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</div>
<p>The last values that can be defined before the optimization portion (as provided below) are the number of iterations
allowed for the Dual Annealing optimization method used (provided by
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.dual_annealing.html#scipy.optimize.dual_annealing">Scipy</a>),
the seed for the random number generation in the optimization method (below we set this to 0 so we can reproduce the
results, None should be used if we want the method to be random), and the print_flag which tells the program if the
objective function value and decision vector for the multi-start method should be printed out (here we set it to False,
which means no output will be provided). See <a class="reference internal" href="classes/crnt4sbml.GeneralApproach.html#crnt4sbml.GeneralApproach.run_optimization" title="crnt4sbml.GeneralApproach.run_optimization"><code class="xref py py-func docutils literal notranslate"><span class="pre">crnt4sbml.GeneralApproach.run_optimization()</span></code></a>
for the default values of the routine.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">iters</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">sd</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">prnt_flg</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<p>Using these values, we run the optimization problem using the following command, which returns a list of the parameters
(which correspond to the input vector) and corresponding objective function values that produce an objective function
value smaller than machine epsilon.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params_for_global_min</span><span class="p">,</span> <span class="n">obj_fun_vals</span> <span class="o">=</span> <span class="n">GA</span><span class="o">.</span><span class="n">run_optimization</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="n">bnds</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="n">iters</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">sd</span><span class="p">,</span> <span class="n">print_flag</span><span class="o">=</span><span class="n">prnt_flg</span><span class="p">,</span>
                                                          <span class="n">dual_annealing_iters</span><span class="o">=</span><span class="n">d_iters</span><span class="p">,</span> <span class="n">confidence_level_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">GA</span><span class="o">.</span><span class="n">generate_report</span><span class="p">()</span>
</pre></div>
</div>
<p>The following is the output obtained after running the above code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Starting optimization ...
Elapsed time for optimization in seconds: 2639.424936056137
It was found that 2.1292329042333798e-16 is the minimum objective function value with a confidence level of 0.680672268907563 .
1 point(s) passed the optimization criteria.
</pre></div>
</div>
<p>From this output, it is apparent that for some networks the optimization for the general approach can take a long time
to complete. For this reason, we have a parallel version of the optimization approach. An example of a parallel general
approach can be found in subsection <a class="reference internal" href="parallel_crnt4sbml.html#parallel-gen-app-label"><span class="std std-ref">Parallel General Approach</span></a> of section <a class="reference internal" href="parallel_crnt4sbml.html#parallel-crnt4sbml-label"><span class="std std-ref">Parallel CRNT4SBML</span></a>.</p>
<p>If the optimization routine returns objective function values smaller than machine epsilon, then bistability analysis can
be conducted. As in <a class="reference internal" href="deficiency_walkthrough.html#my-deficiency-label"><span class="std std-ref">Mass Conservation Approach Walkthrough</span></a> and <a class="reference internal" href="injectivity_walkthrough.html#my-injectivity-label"><span class="std std-ref">Semi-diffusive Approach Walkthrough</span></a> this can be done by using numerical
continuation. See the functions <a class="reference internal" href="classes/crnt4sbml.GeneralApproach.html#crnt4sbml.GeneralApproach.run_continuity_analysis" title="crnt4sbml.GeneralApproach.run_continuity_analysis"><code class="xref py py-func docutils literal notranslate"><span class="pre">crnt4sbml.GeneralApproach.run_continuity_analysis()</span></code></a> and
<a class="reference internal" href="classes/crnt4sbml.GeneralApproach.html#crnt4sbml.GeneralApproach.run_greedy_continuity_analysis" title="crnt4sbml.GeneralApproach.run_greedy_continuity_analysis"><code class="xref py py-func docutils literal notranslate"><span class="pre">crnt4sbml.GeneralApproach.run_greedy_continuity_analysis()</span></code></a> for more information on using numerical continuation with
the general approach. Although numerical continuation can be used by most examples, in some cases, the input vectors
found by the optimization method yield an ODE system that has a singular or ill-conditioned Jacobian. For this reason,
the numerical continuation method will be unsuccessful. In the simple_biterminal example, this is what occurs. To provide
an alternative method to numerical continuation, we have constructed a routine that performs direct simulation in order
to construct the bifurcation diagram. See section <a class="reference internal" href="direct_simulation.html#direct-simulation-label"><span class="std std-ref">Direct Simulation for the General Approach</span></a> for further information on the method.</p>
<p>To run bistability analysis using the direct simulation approach, we run the following routine:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GA</span><span class="o">.</span><span class="n">run_direct_simulation</span><span class="p">(</span><span class="n">params_for_global_min</span><span class="p">,</span> <span class="n">dir_path</span><span class="o">=</span><span class="s1">&#39;./num_cont_graphs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This routine will use the input vectors (named params_for_global_min) provided by the optimization and perform the direct
simulation approach for bistability analysis, then puts the plots produced in the directory path ./num_cont_graphs. This
provides the following output for the simple_biterminal example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Starting direct simulation ...
Elapsed time for direct simulation in seconds: 201.63968706130981
</pre></div>
</div>
<p>Along with this, it also produces the following bifurcation diagram.</p>
<a class="reference internal image-reference" href="_images/simple_biterminal_direct_sim.png"><img alt="_images/simple_biterminal_direct_sim.png" class="align-center" src="_images/simple_biterminal_direct_sim.png" style="width: 550px; height: 300px;" /></a>
<p>Similar to the optimization for the general approach, we can see that direct simulation can take a long time
to complete. For this reason, we have a parallel version of the direct simulation approach. An example of a parallel
direct simulation run for the general approach can be found in subsection <a class="reference internal" href="parallel_crnt4sbml.html#parallel-gen-app-label"><span class="std std-ref">Parallel General Approach</span></a> of
section <a class="reference internal" href="parallel_crnt4sbml.html#parallel-crnt4sbml-label"><span class="std std-ref">Parallel CRNT4SBML</span></a>.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parallel_crnt4sbml.html" class="btn btn-neutral float-right" title="Parallel CRNT4SBML" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="injectivity_walkthrough.html" class="btn btn-neutral float-left" title="Semi-diffusive Approach Walkthrough" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Brandon Reyes

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>